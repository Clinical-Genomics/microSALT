{% extends 'layout.html' %}

{% block body %}
    <div class="container-fluid">
        <div class="col-lg-16">
                  {% for sample in samples %}
                    <div class="panel">
                    <div class="panel-body">
                    <footer>
                    <h2 class="page-header"><div class="row"></div><strong>microSALT Results</strong><br>
                        <small>Clinical Microbiology</small>
                        <small><p align="right">{{date}}</p></small></h2>
                        <div class="table-responsive">
                                <table  class="table table-bordered" >
                                        <tr>
                                            <td><b>Project ID <i>(CG Project ID)</i></b></td>
                                            <td>{{sample.projects.Customer_ID_project}} <i>({{sample.projects.CG_ID_project}})</i></td>
                                            
                                        </tr>
                                        <tr>
                                            <td><b>Sample ID <i>(CG Sample ID)</i></b></td>
                                            <td>{{sample.Customer_ID_sample}}  <i>({{sample.CG_ID_sample}})</i></td>
                                        </tr>
                                        <tr>
                                            <th scope="row" >Analysis date</th>
                                            <td>{{sample.date_analysis.date()}}</td>
                                        </tr>
                                        <tr>
                                            <th scope="row" >Organism</th>
                                            <td><i>{{sample.organism.replace('_', ' ').title()}}</i></td>
                                        </tr>
                                        <tr>
                                            <th scope="row" >Sequence Type</th>
                                            {% if sample.ST > 0 %}
                                              <td>{{sample.ST}}</td>
                                            {% elif sample.ST == -1 %}
                                              <td>Control sample. No ST established.</td>
                                            {% else %}
                                              <td>No ST found. Displaying all allele hits.</td>
                                            {% endif %}
                                        </tr>
                                        <tr>
                                            <th scope="row" >Thresholds</th>
                                              {% for seq_type in sample.seq_types %}
                                                {% if seq_type.identity < 100.00 or sample.ST < 0 %}
                                                  {% set miss=True %}
                                                {% endif %}
                                                {% if loop.last %}
                                                  {% if not miss %}<td>Passed</td>{% else %}<td>Failed</td>{% endif %}
                                                {% endif %}
                                              {% endfor %}

                                </table>
                            </div>
                            <div class="table-responsive">
                                <table  class="table table-bordered" >
                                    <thead>
                                        <tr>
                                            <th>Loci</th>
                                            <th width="18%">Allele</th>
                                            <th>Contig Coverage</th>
                                            <th>Haplotype</th>
                                            <th>Identity</th>
                                            <th>E-value</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for seq_type in sample.seq_types %}
                                          {% if seq_type.st_predictor %}
                                        <tr>
                                            <td>{{seq_type.loci}}</td>
                                            <td width="18%"> {{ seq_type.allele}}</td>
                                            <td>{{ seq_type.contig_coverage|round(2)  }}</td>
                                            <td>{{ seq_type.haplotype }}</td>
                                            <td>{{ seq_type.identity|round(2) }}</td>
                                            <td>{{ seq_type.evalue }}</td>
                                        </tr>
                                        {% endif %}
                                      {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                    </footer>
                </div>
            </div>
          {% endfor %}
        </div>
    </div>
</div>



{% endblock %}
